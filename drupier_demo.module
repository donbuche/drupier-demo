<?php

/**
 * @file
 * Drupier Demo module hooks.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function drupier_demo_help(string $route_name, RouteMatchInterface $route_match): array {
  $is_help_page = $route_name === 'help.page';
  $is_module_help_page = $route_name === 'help.page.drupier_demo';
  $module_name = $route_match->getParameter('name');

  if (!$is_module_help_page && !($is_help_page && $module_name === 'drupier_demo')) {
    return [];
  }

  return [
    '#type' => 'container',
    'intro' => [
      '#type' => 'markup',
      '#markup' => '<p>Drupier Demo is a simple, install-only module that ships with the Drupier theme to provide default content for demo and onboarding purposes. It is <strong>not</strong> intended for production use.</p>',
    ],
    'what' => [
      '#type' => 'markup',
      '#markup' => '<h2>What it does</h2><ul><li>Creates a predefined <strong>Main navigation</strong> (<code>main</code>) menu structure with nested items.</li><li>Adds a custom block plugin (<code>MarqueeExampleBlock</code>) and creates a block instance assigned to the <code>header_first</code> region.</li></ul>',
    ],
    'notes' => [
      '#type' => 'markup',
      '#markup' => '<h2>Important notes</h2><ul><li>This module exists only to show placeholder content when the Drupier theme is installed.</li><li><strong>Disable this module before starting real development.</strong></li><li>You should also <strong>uninstall it</strong> once you no longer need the demo content.</li></ul>',
    ],
    'cleanup' => [
      '#type' => 'markup',
      '#markup' => '<h2>Uninstall cleanup</h2><p>When uninstalled, the module removes:</p><ul><li>All menu items it created.</li><li>The block instance it created (even if it was placed in a region).</li></ul>',
    ],
    'commands' => [
      '#type' => 'markup',
      '#markup' => '<h2>Disable and uninstall</h2><p>Disable the module with Drush:</p><pre><code>drush pm:uninstall drupier_demo -y</code></pre><p>Remove it from codebase with Composer:</p><pre><code>composer remove drupier_demo</code></pre>',
    ],
    'location' => [
      '#type' => 'markup',
      '#markup' => '<h2>Location</h2><p><code>web/modules/custom/drupier_demo</code></p>',
    ],
  ];
}

/**
 * Implements hook_page_attachments().
 */
function drupier_demo_page_attachments(array &$attachments): void {
  $admin_context = \Drupal::service('router.admin_context');
  if ($admin_context->isAdminRoute()) {
    return;
  }

  $help_url = \Drupal\Core\Url::fromRoute('help.page', ['name' => 'drupier_demo'])->toString();
  \Drupal::messenger()->addWarning(
    'You are viewing default content generated by the Drupier Demo module. Remember to disable and uninstall it before starting real development. <a href="' . $help_url . '">View help</a>.'
  );
}
